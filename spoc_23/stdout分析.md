# stdout分析


##1 到系统调用的过程

追踪`cprintf`函数，可以看到最终实际进行字符输出的函数是`sys_putc`函数，后者调用系统调用`SYS_putc`。

##2 系统调用实现分析

* 系统调用最终会调用到`cons_putc`函数向控制台输出函数。它进一步调用`cga_putc`。
* 输出的过程中，有两个全局变量：`crt_buf`是一个显示器缓冲区；`crt_pos`记录缓冲区最后一个字符的位置。
* 每次输出字符，则是直接改写数组中的对应位置。对于换行等字符，则是使用行长度`CRT_COLS`等预定义宏操作缓冲区指针`crt_pos`。

##3 时间效率分析

* `crt_buf`缓冲区是内存中的一个确定的位置，在`cga_init`中完成初始化。显示器从内存区中直接读字符进行显示，即使用DMA方式，适于大量数据的传输。
* 打印输出字符的时间是困难的。因为打印需要通过`stdout`，使用`stdout`输出需要打印，如果每次都输出，子子孙孙无穷匮也。如果分别输出，也会因为输出时间本身的代价造成较大的干扰。

